#!/bin/bash

host="pkgbuild.com"

PKGEXT=".pkg.tar.xz"

DEST="."

usage(){
  echo "A simple script to download a package to the local machine"
  echo ""
  echo "usage: $(basename $0) <pkgbase> [path]"
  echo ""
  echo "path is set to svn-packages as default"
  echo ""

  exit 1
}

main() {
  [ $# -eq 0 ] && usage

  if [ -z ${2} ]; then
    path="svn-packages"
  else
    path="${2}"
  fi
  
  if [ -z ${3} ]; then
    svnbranch="trunk"
  else
    svnbranch="${3}"
  fi

  # Package folder structure on the host is something like ~/svn-packages/pkgname/trunk/
  for pkg in `ssh ${host} ls ${path}/${1}/${svnbranch}/*${PKGEXT}`; do
    rsync -e ssh -p --chmod=ug=rw,o=r -c -h -L --progress --partial -y ${host}:${pkg} ${DEST} || exit 1
  done
}

main $@

exit 0
